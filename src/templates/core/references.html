{% extends 'multiplicity/base.html' %}
{% load static %}

{% block title %}Publications{% endblock %}
{% block container %}stretch-bg-head{% endblock %}

{% block content %}

<div class="container">

  <h1>Search our database</h1>

  <p>
    Please enter search terms below to start your search. You will see a list of common terms
    appear as you start typing. To confirm each search term, please hit ENTER to add it to 
    the list. The system will only show records that contain <strong>all</strong> of the 
    search terms that you enter. Remove search terms to increase the number of results.
    When you see the results, use the filters on the left hand side to refine your results.
  </p>

  <div class="resultbox">

    <form action="#" method="post" class="col-xs-12 col-sm-10 col-sm-offset-1 pad-hor">
      <div class="input-group mar-btm">
        <select name="search[]" class="form-control select2" id="searchbox" multiple></select>
          <span class="input-group-btn">
            <button class="btn btn-success btn-lg" type="button">Search</button>
          </span>
      </div>
    </form>

  </div>

  <div class="alert alert-info">
    <a href="publications.export.php" class="btn btn-default">
      <i class="fa fa-table"></i>
      Download
    </a>
    You can download the full publications database including publication title, author(s), year, journal, tags, etc. as a <strong>CSV file</strong>.
  </div>

  <div class="row filters">
  
    <div class="col-md-3 ">
      <ul class="nav nav-section-menu nav-sidebar">
        <li class="nav-header">Filter by Year</li>
          <li class="">
            <a href="#" class="nav-link filter" data-id="2017" data-type="year">2017 
              <span class="pull-right badge badge-default">1</span>
            </a>
          </li>
        <li>
          <a href="#" class="show-all nav-link" data-type="year">Show all 
            <i class="fa fa-angle-down"></i>
          </a>
        </li>
      </ul>
    </div>

    
    <div class="col-md-9 main records">

      <div class="resultbox">
        <i class="fa fa-info-circle"></i>
        <strong>{{ list.count }}</strong>
        publications found.
      </div>

      {% for details in list %}

        <div class="panel">
          <div class="panel-heading">
              <h3 class="panel-title">
                <a href="{% url 'core:reference' details.id %}">{{ details.title }}</a>
              </h3>
          </div>
          <div class="panel-body">
            {{ details.authorlist }}
          </div>
          <div class="panel-footer">
            <span class="type">{{ details.type.name }}
            </span>
          </div>

        </div>

      {% endfor %}

    </div>

  </div>

</div>

{% endblock %}

{% block head %}
{% endblock %}

{% block sidebar %}
{% include 'multiplicity/sidebar.default.html' %}

{% endblock %}

{% block pagehead %}
<div id="page-head">
    
    <div id="page-title">
        <h1 class="page-header text-overflow">{{ title }}</h1>
    </div>

    <ol class="breadcrumb">
        <li><a href="./"><i class="pli-home"></i></a></li>
        <li><a href="{% url 'core:resources_home' %}">Resources</a></li>
        <li class="active">{{ title }}</li>
    </ol>

</div>
{% endblock %}

{% block footer %}

  <script type="text/javascript">
  $(function(){
    $(".filters .filter").click(function(e){
      e.preventDefault();
      var type = $(this).data("type");
      var id = $(this).data("id");
      var hide = ".recordbox:not(."+type+"-"+id+")";
      var show = ".recordbox."+type+"-"+id;
      $(show).show('fast');
      $(hide).hide('fast');
      $(this).closest("ul").find("li a").removeClass('active');
      $(this).addClass("active");
    });
    $(".show-all").click(function(e){
      e.preventDefault();
      var type = $(this).data("type");
      $(".hide-"+type).show('fast');
      $(this).hide();
    });
    $("#searchbox").select2({
      tags: true,
      tokenSeparators: [',']
    })
  });
</script>
{% endblock %}
