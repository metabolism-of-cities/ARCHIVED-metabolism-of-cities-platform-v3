  <div class="panel padding10">
    <div class="panel-content">
      <div id="map"></div>
    </div>
  </div>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script type="text/javascript">

        var leafletMap = L.map('map').setView([{{ info.location.lat }}, {{ info.location.lng }}], {{ info.location.default_zoom|default_if_none:12 }});

        var bluemarker = L.divIcon({className: 'bluemarker'});
        var darkbluemarker = L.divIcon({className: 'darkbluemarker'});
        var greenmarker = L.divIcon({className: 'greenmarker'});
        var yellowmarker = L.divIcon({className: 'yellowmarker'});
        var redmarker = L.divIcon({className: 'redmarker'});

        var basemap = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiY29tbXVuaXRyZWUiLCJhIjoiY2lzdHZuanl1MDAwODJvcHR1dzU5NHZrbiJ9.0ETJ3fXYJ_biD7R7FiwAEg', {
          maxZoom: 19,
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
          id: 'mapbox.streets'
        }).addTo(leafletMap);

        leafletMap.scrollWheelZoom.disable();

        var capetown      = L.marker([-33.8161, 18.2675], {icon:darkbluemarker}),
            durban        = L.marker([-33.8661, 18.2675], {icon:darkbluemarker}),
            joburg        = L.marker([-33.9161, 18.2675], {icon:redmarker}),
            pretoria      = L.marker([-33.9661, 18.2675], {icon:redmarker});
            port_elizabth = L.marker([-33.9661, 18.2975], {icon:greenmarker});
            bloemfontein  = L.marker([-33.9661, 18.2375], {icon:greenmarker});

        // these variable names are used in the showOneLayer function below
        var dams = L.featureGroup([capetown, durban]).addTo(leafletMap);
        var reservoirs = L.featureGroup([joburg, pretoria]).addTo(leafletMap);
        var treatment = L.featureGroup([port_elizabth, bloemfontein]).addTo(leafletMap);

        // this group exists in order to show or hide all layers on the map
        allFeatureGroups = [dams, reservoirs, treatment];

        // this group exists to show the checkboxes on the map. The format is "label": variable. It can contain html, as shown in the current example
        allLayers = {
          "<img src='/static/multiplicity/img/markers/marker.blue.svg'/> dams": dams,
          "reservoirs": reservoirs,
          "treatment": treatment,
        }

        L.control.layers(null, allLayers, {collapsed: false}).addTo(leafletMap);

        {% for details in spaces %}
          {% if details.location.lat %}
            L.marker([{{ details.location.lat }}, {{details.location.lng }}], {icon:{{ details.type.marker_color}}marker, riseOnHover: true}).addTo(leafletMap)
            .bindPopup("<b>{{ details.name }}</b><br>{{ details.type.name }}<br />{% if details.image %}<a href='{% url 'multiplicity:space' info.slug details.type.topic.slug details.type.slug details.slug %}'><img src='{{ details.image.url }}' /></a>{% endif %}<br /><a class='button is-info' href='{% url 'multiplicity:space' info.slug details.type.topic.slug details.type.slug details.slug %}'>View details</a>. ", {minWidth:200});
          {% endif %}
        {% endfor %}

        // remove and add layers
        function showAllLayers(){
          $(allFeatureGroups).each(function() {
            leafletMap.addLayer(this);
          })
        };

        function removeAllLayers() {
          $(allFeatureGroups).each(function() {
            leafletMap.removeLayer(this);
          })
        };

        function showOneLayer(group) {
          removeAllLayers();
          leafletMap.addLayer(group);
        }
    </script>
